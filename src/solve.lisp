(in-package codewordsolver)

(defparameter *alphabet*
  ;; Sorted by word list frequency.
  ;; Most frequent first.
  (list #\e #\i #\a #\o #\n #\s #\r #\t
        #\l #\c #\u #\p #\d #\m #\h #\g
        #\y #\b #\f #\v #\k #\w #\z #\x
        #\q #\j))

(defun solve-codeword (codes clues wordlist)
  "CODES should be a list of codes like ((1 2 3) (3 3 1)), while CLUES should be an alist of number->letter assignments. WORDLIST should be a list of valid words.

Returns an alist of number->letter, the solution, as well as the resulting list of words."
  (let* ((candidates
           (loop for code in codes
                 collect (list code
                               (find-candidates code clues wordlist))))
         (solution-clues (solve-aux candidates clues)))
    (values solution-clues
            (loop for code in codes collect
                  (format nil
                          "狺祜镳骘轭泔溴泔祆邈ㄦ轭洵沆蹂箫祯糸镱沆蹂瞟┅┅┅ㄤ彐躅箫祧瀛狨ㄣ犷溟溽翦沆蹂螬ㄣ镱换澡弪濮泔溴鏖翳铒痫篌殁戾箫祯糸镱麇鲥换栝溴徜孱洚è箫礤灬礅溽ㄣ犷溟溽翦铒箦泔钿汜钿殇狒濠┅汜钿殇狒弩铋飑换领泔溴泔眇戾翦蝈趱蝾箫祯糸镱è铒汜钿殇狒弩沆蹂螬换澎箦趄麸骈祆轭镱镦翳泔溴螽换则翳泔溴鏖翳翳驽麇篝痫篌殁戾黠蜾蟋轸ъ换钺蝌秣滹黝翳箦狎汨戾舄è忮篝ㄡ戾犷潋獒哄趄屙蹴汜钿殇狒弩＇弘妁灬礅溽ㄣ犷溟溽翦戾铉翳箦泔钿汜钿殇狒濠┅┅ㄣ镤ㄦ轵篝忮篝┅黠蜾箦泔钿忮篝┅换组祆蝈趱蝾铋ㄦ犰箦殒铒铄镦翳黠蜾玳鲥换箫祯糸镱祜镳骘黠蜾轭黠蜾滹眭祠轲戾鲠祯瀛忾钿铄鳝汜钿殇狒弩铄鳝沆蹂螬痱镳徵狒泔溴黠蜾蝈盹鲥忮篝汜钿殇狒弩沆蹂螬戾è箫祯糸镱箫祧瀛狨铄鳝汜钿殇狒弩铄鳝沆蹂螬┅麒孱箫祯糸镱蝈趱蝾箫祯糸镱┅┅┅┅ㄤ彐躅痱镳徵狒ㄣ镤黠蜾汜钿殇狒弩沆蹂螬换霄弪蜷溟铉翳钺礤镦翳矧殓轭犰汜钿殇狒弩沆蹂桢蝈骚换徭蜥殇镦徙汩溴铘犰禊躞轭翳镬镱弩迈翳轶轶犰箫蹒禊戾舄è沆蹂ㄡ滗黠蜾沆蹂沆蹂泔溴黠蜾┅ㄣ犷溟溽翦祜镳骘ㄣ镤黠蜾螬轭汜钿殇狒弩泔祆邈扉篝泔溴祜镳骘黠蜾轭黠蜾麒孱磲翥桢蟓泔溴泔溴沆蹂黠蜾泔祆邈黠蜾┅┅箝铉戾黠蜾汜钿殇狒弩祜镳骘汜钿殇狒轭汜钿殇狒弩麒孱戾铉翳箦泔钿汜钿殇狒濠┅泔祆邈汜钿殇狒濠┅ㄣ镱换族鲥栝溴徜孱狍蝈篚祠镦痱镳徵狒轱瞵篝镳换麽篝轭糸礤犷蝈趱蝾è箫礤灬礅溽ㄣ犷溟溽翦铒箦泔钿汜钿殇狒濠┅汜钿殇狒弩鲠祯弩汜钿殇狒弩沆蹂螬换语礤泔溴栳鲥镱禊箝铉戾蝈磲轭轭黠蜾翳狒汜换痫篌殁禊骈翳屙箫痱镳徵狒轱汜泔铘轭蹂箝铉戾黠蜾汜钿殇狒弩戾舄è汨矬孱汜钿殇狒ㄣ狎箝铉戾黠蜾汜钿殇狒弩┅铄舡泔溴ㄣ狎汨矬孱汜钿殇狒濠铄舡黠蜾ㄣ狎箦泔钿汨矬孱汜钿殇狒濠┅痱镳徵狒铄舡泔溴铄舡黠蜾蝈盹鲥汨矬孱汜钿殇狒汜钿殇狒弩沆蹂螬┅换物骢螋桢痱镳徵狒轱痫篌殁戾蝈趱蝾麒狒麇栳鲥鲠祯弩汜钿殇狒弩沆蹂螬┅┅ㄤ彐躅骈钿汜钿殇狒弩ㄣ镤沆蹂黠蜾扉篝祜镳骘黠蜾轭黠蜾扉篝麒孱磲翥桢蟓泔溴泔溴沆蹂黠蜾泔祆邈黠蜾┅ㄤ彐躅磲翥桢蟓泔溴ㄣ镤沆蹂黠蜾ㄡ钿戾铉翳泔溴戾铉翳黠蜾┅戾è铄鳝沆蹂磲脲沆蹂螬┅祜镳骘轭泔溴骘戾趑弪徙蝻篌黠蜾犰麽戾è沆蹂矧ㄦ轭洵沆蹂沆蹂瞟ㄦ轭洵沆蹂铄鳝沆蹂瞟┅ㄩ沆蹂ㄣ栳蚪沆蹂戾趑弪戾è戾趑弪狍箝珙邃矧ㄦ轭洵沆蹂戾趑弪ㄦ轭洵铄鳝沆蹂戾趑弪┅┅麒孱铒戾趑弪狍箝珙邃咯箦翩铄鳝沆蹂ㄡ滗沆蹂铄鳝沆蹂戾趑弪┅铒戾趑弪狍箝珙邃咯┅┅┅ㄤ彐躅磲脲沆蹂ī扉篝┅ㄤ彐躅骈钿沆蹂ㄣ祯弩瞟ㄣ潋ㄡ篌镢沆蹂螬┅ㄤ彐躅骈钿ㄣ祯弩戾趑弪ㄣ狎蜥篌镢戾趑弪沆蹂螬┅ㄤ彐躅徜洵沆蹂ㄣ祯弩戾趑弪瘐箬ㄣ镱戾趑弪沆蹂螬ㄤ彐躅徜洵黠蜾沆蹂ㄣ祯弩泔溴黠蜾祜镳骘轭泔溴骘戾趑弪徙蝻篌黠蜾麒孱铒ㄦ轭洵沆蹂沆蹂瞟滹箦翩沆蹂ㄡ滗沆蹂沆蹂戾趑弪┅沆蹂螬ㄤ彐躅祜徜黠蜾疳翳鏖翳镳孱骈戾篝蝈犴疳翳祜镳骘扉铄蝈徜扉铄篝蝈犴铋飑麒殪扉铄泔祆邈篝蜷铉趄轫Ж＼羽徙＼五黛轭＼箩汶箴徙＼葬＼涕铄驽邃＼嗅珏＼义趱蝾＼阴怙豸扉铄┅┅